<!DOCTYPE html>
<html>
<head>
    <title>White Noise Generator with Filters and Controls v0.5.1</title>
    <style>
        body {
            background-color: #000; /* Black background */
            color: #fff; /* White text for contrast */
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        #controls {
            display: flex; /* Use flexbox for controls */
            justify-content: center; /* Center the sliders */
            flex-wrap: wrap; /* Allow wrapping on small screens */
        }
        .slider-container {
            display: flex; /* Flex display for each container */
            flex-direction: column; /* Stack elements vertically */
            align-items: center; /* Center elements in container */
            margin: 5px; /* Reduced margin */
        }
        .slider {
            writing-mode: bt-lr; /* IE */
            -webkit-appearance: slider-vertical; /* WebKit */
            width: 20px; /* Increased for better touch */
            height: 200px; /* Increased for better touch */
            margin: 5px 0; /* Space around slider */
        }
        button {
            font-size: 1.2em; /* Larger font size */
            padding: 10px 20px; /* Larger padding for better touch */
            margin: 10px; /* Space out buttons */
        }
        @media (max-width: 600px) {
            .slider-container {
                width: 100%; /* Full width on small screens */
            }
            .slider {
                width: 100%; /* Full width slider */
                height: 50px; /* Horizontal slider for small screens */
                writing-mode: lr-tb; /* Horizontal slider for small screens */
            }
            button {
                width: 90%; /* Full width buttons with margin */
                margin: 5px 5%; /* Center buttons with margin */
            }
        }
    </style>
</head>
    
<body>
    <div id="controls"></div>
    <div>
        <input type="radio" id="whiteNoise" name="noiseType" value="white" checked>
        <label for="whiteNoise">White Noise</label><br>
        <input type="radio" id="pinkNoise" name="noiseType" value="pink">
        <label for="pinkNoise">Pink Noise</label><br>
        <input type="radio" id="brownNoise" name="noiseType" value="brown">
        <label for="brownNoise">Brown Noise</label>
    </div>
    <button id="audioButton" onclick="toggleAudio()">Initialize Audio</button>
    <button onclick="resetBands(0)">Reset Bands to 0</button>
    <button onclick="resetBands(0.5)">Center Bands</button>
    <button onclick="adjustBands(-0.1)">Decrease All</button>
    <button onclick="adjustBands(0.1)">Increase All</button>
    <script>
        var context;
        var noiseProcessor, gainNodes = [], isPlaying = false;
        var currentNoiseType = 'white'; // Initialize currentNoiseType
        var frequencyBands = [
            [20, 39], [39, 79], [79, 158], [158, 316], [316, 632],
            [632, 1261], [1261, 2517], [2517, 5023], [5023, 10023], [10023, 20000]
        ];
    
        document.querySelectorAll('input[name="noiseType"]').forEach(function(radio) {
            radio.addEventListener('change', function() {
                currentNoiseType = this.value;
                if (isPlaying) {
                    playNoise(); // Call playNoise to reflect the change immediately
                }
            });
        });
    
        function createBandpassFilter(lowFreq, highFreq) {
            var filter = context.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.value = (lowFreq + highFreq) / 2;
            filter.Q.value = filter.frequency.value / (highFreq - lowFreq);
            return filter;
        }
    
        function toggleAudio() {
            if (!context) {
                context = new AudioContext();
            }
    
            if (!isPlaying) {
                playNoise();
                document.getElementById("audioButton").innerText = "Stop Audio";
                isPlaying = true;
            } else {
                stopNoise();
                document.getElementById("audioButton").innerText = "Initialize Audio";
                isPlaying = false;
            }
        }
    
        function playNoise() {
            if (!noiseProcessor || noiseProcessor.context.state === 'closed') {
                noiseProcessor = context.createScriptProcessor(4096, 1, 1);
            }

            noiseProcessor.onaudioprocess = function(e) {
                var output = e.outputBuffer.getChannelData(0);
                for (var i = 0; i < output.length; i++) {
                    if (currentNoiseType === 'white') {
                        output[i] = generateWhiteNoise();
                    } else if (currentNoiseType === 'pink') {
                        output[i] = generatePinkNoise(i);
                    } else if (currentNoiseType === 'brown') {
                        output[i] = generateBrownNoise(i);
                    }
                }
            };

            setupGainNodes(); // Set up or re-establish the connections with gain nodes
        }

        function setupGainNodes() {
            if (gainNodes.length === 0) {
                frequencyBands.forEach(function(band, index) {
                    var filter = createBandpassFilter(band[0], band[1]);
                    var gainNode = context.createGain();
                    gainNodes[index] = gainNode;

                    noiseProcessor.connect(filter);
                    filter.connect(gainNode);
                    gainNode.connect(context.destination);

                    var savedValue = localStorage.getItem('sliderValue' + index);
                    gainNode.gain.value = savedValue !== null ? parseFloat(savedValue) : 0.5;
                });
            } else {
                gainNodes.forEach(function(gainNode, index) {
                    gainNode.disconnect();
                    var filter = createBandpassFilter(frequencyBands[index][0], frequencyBands[index][1]);
                    noiseProcessor.connect(filter);
                    filter.connect(gainNode);
                    gainNode.connect(context.destination);
                });
            }
        }
        
        // Function to generate white noise
        function generateWhiteNoise() {
            return Math.random() * 2 - 1;
        }

        function generatePinkNoise(index) {
            // Basic pink noise generator using a series of low-pass filters
            // You might need a more complex algorithm for accurate pink noise generation
            var b0, b1, b2, b3, b4, b5, b6;
            b0 = b1 = b2 = b3 = b4 = b5 = b6 = 0.0;
            var white = Math.random() * 2 - 1;
            b0 = 0.99886 * b0 + white * 0.0555179;
            b1 = 0.99332 * b1 + white * 0.0750759;
            b2 = 0.96900 * b2 + white * 0.1538520;
            b3 = 0.86650 * b3 + white * 0.3104856;
            b4 = 0.55000 * b4 + white * 0.5329522;
            b5 = -0.7616 * b5 - white * 0.0168980;
            var pink = b0 + b1 + b2 + b3 + b4 + b5 + b6 + white * 0.5362;
            pink *= 0.11; // Adjust to proper level
            b6 = white * 0.115926;
            return pink;
        }

        function stopNoise() {
            if (noiseProcessor) {
                noiseProcessor.disconnect();
                noiseProcessor = null;
                gainNodes.forEach(function(gainNode) {
                    gainNode.disconnect();
                });
                gainNodes = [];
            }
        }

        function resetBands(value) {
            for (var i = 0; i < frequencyBands.length; i++) {
                setSliderValue(i, value);
            }
        }

        function adjustBands(delta) {
            for (var i = 0; i < frequencyBands.length; i++) {
                var currentValue = gainNodes[i] ? gainNodes[i].gain.value : 0.5;
                setSliderValue(i, Math.max(0, Math.min(1, currentValue + delta)));
            }
        }

        function setSliderValue(index, value) {
            var slider = document.getElementById('slider' + index);
            if (slider) {
                slider.value = value;
                localStorage.setItem('sliderValue' + index, value);
                if (gainNodes[index]) {
                    gainNodes[index].gain.value = value;
                }
            }
        }
        // Modify existing slider creation to include value display
        frequencyBands.forEach(function(band, index) {
            var container = document.createElement('div');
            container.className = 'slider-container';

            var slider = document.createElement('input');
            slider.type = 'range';
            slider.className = 'slider';
            slider.id = 'slider' + index;
            slider.min = 0;
            slider.max = 1;
            slider.step = 0.01;
            slider.value = localStorage.getItem('sliderValue' + index) || 0.5;
            slider.orientation = 'vertical';

            var label = document.createElement('span');
            label.textContent = `${band[0]}-${band[1]} Hz`;

            var valueDisplay = document.createElement('span');
            valueDisplay.id = 'valueDisplay' + index;
            valueDisplay.textContent = ' (' + slider.value + ')';

            slider.oninput = function() {
                var value = parseFloat(this.value);
                document.getElementById('valueDisplay' + index).textContent = ' (' + value + ')';
                localStorage.setItem('sliderValue' + index, value);
                if (gainNodes[index]) {
                    gainNodes[index].gain.value = value;
                }
            };

            container.appendChild(label);
            container.appendChild(valueDisplay);
            container.appendChild(slider);

            document.getElementById('controls').appendChild(container);
        });
    </script>
</body>
</html>
