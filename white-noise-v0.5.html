<!DOCTYPE html>
<html>
<head>
    <title>White Noise Generator with Filters and Controls</title>
    <style>
        body {
            background-color: #000; /* Black background */
            color: #fff; /* White text for contrast */
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .slider-container {
            display: inline-block;
            margin: 10px;
        }
        .slider {
            writing-mode: bt-lr; /* IE */
            -webkit-appearance: slider-vertical; /* WebKit */
            width: 8px;
            height: 150px;
            padding: 0 5px;
        }
    </style>
</head>
<body>
    <div id="controls"></div>
    <button id="audioButton" onclick="toggleAudio()">Initialize Audio</button>
    <script>
        var context;
        var whiteNoise, gainNodes = [], isPlaying = false;
        var frequencyBands = [
            [20, 39], [39, 79], [79, 158], [158, 316], [316, 632],
            [632, 1261], [1261, 2517], [2517, 5023], [5023, 10023], [10023, 20000]
        ];

        function createBandpassFilter(lowFreq, highFreq) {
            var filter = context.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.value = (lowFreq + highFreq) / 2;
            filter.Q.value = filter.frequency.value / (highFreq - lowFreq);
            return filter;
        }

        function toggleAudio() {
            if (!context) {
                context = new AudioContext();
            }

            if (!isPlaying) {
                playWhiteNoise();
                document.getElementById("audioButton").innerText = "Stop Audio";
                isPlaying = true;
            } else {
                stopWhiteNoise();
                document.getElementById("audioButton").innerText = "Initialize Audio";
                isPlaying = false;
            }
        }

        function playWhiteNoise() {
            var bufferSize = 4096;
            whiteNoise = context.createScriptProcessor(bufferSize, 1, 1);
            whiteNoise.onaudioprocess = function(e) {
                var output = e.outputBuffer.getChannelData(0);
                for (var i = 0; i < bufferSize; i++) {
                    output[i] = Math.random() * 2 - 1;
                }
            };

            // Create filters and connect them, but only if not already connected
            if (gainNodes.length === 0) {
                frequencyBands.forEach(function(band, index) {
                    var filter = createBandpassFilter(band[0], band[1]);
                    var gainNode = context.createGain();
                    gainNodes[index] = gainNode;

                    whiteNoise.connect(filter);
                    filter.connect(gainNode);
                    gainNode.connect(context.destination);

                    // Set gain node values from the sliders if they have been initialized
                    var savedValue = localStorage.getItem('sliderValue' + index);
                    if (savedValue !== null) {
                        gainNode.gain.value = parseFloat(savedValue);
                    } else {
                        gainNode.gain.value = 0.5; // Default volume
                    }
                });
            }
        }

        function stopWhiteNoise() {
            if (whiteNoise) {
                whiteNoise.disconnect();
                gainNodes.forEach(function(gainNode) {
                    gainNode.disconnect();
                });
                whiteNoise = null;
                gainNodes = [];
            }
        }

        // Create UI controls and load saved values
        frequencyBands.forEach(function(band, index) {
            var container = document.createElement('div');
            container.className = 'slider-container';

            var slider = document.createElement('input');
            slider.type = 'range';
            slider.className = 'slider';
            slider.min = 0;
            slider.max = 1;
            slider.step = 0.01;
            slider.value = localStorage.getItem('sliderValue' + index) || 0.5;
            slider.orientation = 'vertical';
            slider.oninput = function() {
                var value = parseFloat(this.value);
                // Save the current value to local storage
                localStorage.setItem('sliderValue' + index, value);
                // Update gain node value if it has been initialized
                if (gainNodes[index]) {
                    gainNodes[index].gain.value = value;
                }
            };

            var label = document.createElement('span');
            label.textContent = `${band[0]}-${band[1]} Hz`;
            container.appendChild(label);
            container.appendChild(slider);

            document.getElementById('controls').appendChild(container);
        });

    </script>
</body>
</html>